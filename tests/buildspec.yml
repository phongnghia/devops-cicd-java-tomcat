version: 0.2

phases:
  install:
    runtime-versions:
      java: corretto17
    commands:
      - cd java_tomcat_application
      - mvn clean package; cd ..
      - sudo apt update -y
      - echo Installing Tomcat 9.0.86
      - sudo apt install tomcat9 -y
      - sudo mkdir -p /var/lib/tomcat9/webapps/
      - sudo chmod -R 755 /var/lib/tomcat9/webapps/
      - sudo chown -R tomcat:tomcat /var/lib/tomcat9/webapps/
      - cp java_tomcat_application/target/java-tomcat-application-1.0-SNAPSHOT.war /var/lib/tomcat9/webapps/java_tomcat_application.war
      - ls /usr/libexec/tomcat9
      - sudo /usr/share/tomcat9/bin/startup.sh
  build:
    commands:
      - echo Installing dependencies
      - curl -O https://bootstrap.pypa.io/get-pip.py
      - python3 get-pip.py
      - pip install requests
      - echo Running API tests
      - cd tests
      - python test_api.py

artifacts:
  files: ["**/*"]
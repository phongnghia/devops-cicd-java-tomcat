version: "0.2"

phases:
  build:
    commands:
      - echo Installing dependencies
      - curl -O https://bootstrap.pypa.io/get-pip.py
      - python3 get-pip.py
      - pip install requests
      - echo Running API tests
      - sudo yum update -y
      - sudo amazon-linux-extras enable corretto17
      - sudo yum install -y java-17-amazon-corretto tomcat
      - sudo systemctl start tomcat
      - aws s3 cp s3://devopscicdjavatomcatstack-pipelineartifactsbucket2-ops076t0rsuk/${CODEBUILD_ARTIFACT_NAME} /usr/share/tomcat/webapps/ROOT.war
      - sudo systemctl restart tomcat
      - cd tests
      - python test_api.py

artifacts:
  files: ["**/*"]